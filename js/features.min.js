const FeatureState={favorites:new Set,recentLocations:[],maxRecentLocations:10},FavoritesManager={init(){try{const e=localStorage.getItem("rivian_favorites");if(e){const t=JSON.parse(e);FeatureState.favorites=new Set(t)}this.syncAcrossTabs()}catch(e){console.error("Failed to load favorites:",e)}},addFavorite(e){try{FeatureState.favorites.add(e),this.saveFavorites(),this.updateUI(),this.showNotification("Added to favorites")}catch(e){console.error("Failed to add favorite:",e)}},removeFavorite(e){try{FeatureState.favorites.delete(e),this.saveFavorites(),this.updateUI(),this.showNotification("Removed from favorites")}catch(e){console.error("Failed to remove favorite:",e)}},toggleFavorite(e){FeatureState.favorites.has(e)?this.removeFavorite(e):this.addFavorite(e)},isFavorite:e=>FeatureState.favorites.has(e),getFavorites:()=>Array.from(FeatureState.favorites),getCount:()=>FeatureState.favorites.size,saveFavorites(){try{const e=Array.from(FeatureState.favorites);localStorage.setItem("rivian_favorites",JSON.stringify(e))}catch(e){console.error("Failed to save favorites:",e)}},updateUI(){document.querySelectorAll(".favorite-btn").forEach(e=>{const t=parseInt(e.dataset.locationId),n=this.isFavorite(t);e.classList.toggle("active",n),e.innerHTML=n?this.getHeartIcon(!0):this.getHeartIcon(!1),e.setAttribute("aria-label",n?"Remove from favorites":"Add to favorites")});const e=document.getElementById("favoritesCountBadge");if(e){const t=this.getCount();e.textContent=t,e.style.display=t>0?"inline-block":"none"}const t=document.getElementById("favoritesFilterBtn");if(t){const e=this.getCount();t.disabled=0===e,t.textContent=`My Favorites (${e})`}},getHeartIcon:(e=!1)=>e?'<svg viewBox="0 0 24 24" fill="currentColor" style="width: 20px; height: 20px;">\n                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>\n            </svg>':'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">\n            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>\n        </svg>',filterFavorites(){if(!rivianLocations||0===this.getCount())return;const e=rivianLocations.filter(e=>this.isFavorite(e.id));"undefined"!=typeof LocationManager&&(LocationManager.renderLocationList(e),LocationManager.updateStats(e),LocationManager.updateMapMarkers(e)),document.querySelectorAll(".filter-btn").forEach(e=>{e.classList.remove("active")}),document.getElementById("favoritesFilterBtn")?.classList.add("active")},exportFavorites(){try{const e=this.getFavorites();if(0===e.length)return void alert("No favorites to export");const t=rivianLocations.filter(t=>e.includes(t.id)),n={exported:(new Date).toISOString(),count:e.length,favorites:t},o=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),a=URL.createObjectURL(o),i=document.createElement("a");i.href=a,i.download=`rivian-favorites-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),this.showNotification("Favorites exported successfully")}catch(e){console.error("Failed to export favorites:",e),alert("Failed to export favorites")}},importFavorites(e){try{const t=new FileReader;t.onload=e=>{try{const t=JSON.parse(e.target.result);t.favorites&&Array.isArray(t.favorites)?(t.favorites.forEach(e=>{e.id&&FeatureState.favorites.add(e.id)}),this.saveFavorites(),this.updateUI(),this.showNotification(`Imported ${t.favorites.length} favorites`)):alert("Invalid favorites file format")}catch(e){alert("Failed to parse favorites file")}},t.readAsText(e)}catch(e){console.error("Failed to import favorites:",e),alert("Failed to import favorites")}},syncAcrossTabs(){window.addEventListener("storage",e=>{if("rivian_favorites"===e.key&&e.newValue)try{const t=JSON.parse(e.newValue);FeatureState.favorites=new Set(t),this.updateUI()}catch(e){console.error("Failed to sync favorites across tabs:",e)}})},showNotification(e){const t=document.getElementById("featureNotification");t&&(t.textContent=e,t.classList.add("show"),setTimeout(()=>{t.classList.remove("show")},3e3))}},SharingManager={init(){this.handleDeepLink()},handleDeepLink(){try{const e=new URLSearchParams(window.location.search).get("location");if(e){const t=parseInt(e),n=rivianLocations.find(e=>e.id===t);n&&setTimeout(()=>{"undefined"!=typeof LocationManager&&LocationManager.flyToLocation(n.lng,n.lat,n.id)},1e3)}}catch(e){console.error("Failed to handle deep link:",e)}},generateShareUrl:e=>`${window.location.origin+window.location.pathname}?location=${e}`,async copyShareLink(e,t){try{const t=this.generateShareUrl(e);await navigator.clipboard.writeText(t),FavoritesManager.showNotification("Link copied to clipboard!")}catch(t){this.fallbackCopyToClipboard(this.generateShareUrl(e))}},fallbackCopyToClipboard(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),FavoritesManager.showNotification("Link copied to clipboard!")}catch(e){console.error("Fallback copy failed:",e),alert("Failed to copy link")}document.body.removeChild(t)},async shareViaWebShare(e,t,n){if(navigator.share)try{const o=this.generateShareUrl(e);await navigator.share({title:`Rivian ${t}`,text:`Check out this Rivian location: ${t} - ${n}`,url:o})}catch(n){"AbortError"!==n.name&&(console.error("Share failed:",n),this.copyShareLink(e,t))}else this.copyShareLink(e,t)},shareToTwitter(e,t,n){const o=this.generateShareUrl(e),a=`https://twitter.com/intent/tweet?text=${encodeURIComponent(`Check out ${t} - ${n}`)}&url=${encodeURIComponent(o)}`;window.open(a,"_blank","width=550,height=420")},shareToFacebook(e){const t=this.generateShareUrl(e),n=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`;window.open(n,"_blank","width=550,height=420")},getShareButtonHTML:e=>`\n            <button class="share-btn"\n                    data-location-id="${e.id}"\n                    data-location-name="${e.name}"\n                    data-location-address="${e.address}"\n                    onclick="SharingManager.handleShareClick(this)"\n                    title="Share this location"\n                    aria-label="Share ${e.name}">\n                <svg viewBox="0 0 24 24" fill="currentColor" style="width: 18px; height: 18px;">\n                    <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>\n                </svg>\n            </button>\n        `,handleShareClick(e){const t=parseInt(e.dataset.locationId),n=e.dataset.locationName,o=e.dataset.locationAddress;this.showShareMenu(t,n,o,e)},showShareMenu(e,t,n,o){const a=document.querySelector(".share-menu");a&&a.remove();const i=document.createElement("div");i.className="share-menu";const r=void 0!==navigator.share;i.innerHTML=`\n            ${r?`\n                <button onclick="SharingManager.shareViaWebShare(${e}, '${t}', '${n}')">\n                    <svg viewBox="0 0 24 24" fill="currentColor" style="width: 18px; height: 18px;">\n                        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>\n                    </svg>\n                    Share...\n                </button>\n            `:""}\n            <button onclick="SharingManager.copyShareLink(${e}, '${t}')">\n                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">\n                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>\n                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>\n                </svg>\n                Copy Link\n            </button>\n            <button onclick="SharingManager.shareToTwitter(${e}, '${t}', '${n}')">\n                <svg viewBox="0 0 24 24" fill="currentColor" style="width: 18px; height: 18px;">\n                    <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>\n                </svg>\n                Twitter\n            </button>\n            <button onclick="SharingManager.shareToFacebook(${e})">\n                <svg viewBox="0 0 24 24" fill="currentColor" style="width: 18px; height: 18px;">\n                    <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/>\n                </svg>\n                Facebook\n            </button>\n        `,document.body.appendChild(i);const s=o.getBoundingClientRect();i.style.top=`${s.bottom+5}px`,i.style.left=`${s.left}px`,setTimeout(()=>{document.addEventListener("click",function e(t){i.contains(t.target)||t.target===o||(i.remove(),document.removeEventListener("click",e))})},0)}},ExportManager={printLocation(e){const t=window.open("","_blank"),n=this.generatePrintContent([e]);t.document.write(n),t.document.close(),t.focus(),setTimeout(()=>{t.print()},250)},printAllLocations(){const e=window.open("","_blank"),t=this.generatePrintContent(rivianLocations);e.document.write(t),e.document.close(),e.focus(),setTimeout(()=>{e.print()},250)},generatePrintContent:e=>`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>Rivian Locations</title>\n                <style>\n                    @media print {\n                        body {\n                            font-family: Arial, sans-serif;\n                            padding: 20px;\n                            font-size: 12pt;\n                        }\n                        h1 {\n                            color: #4CAF50;\n                            border-bottom: 2px solid #4CAF50;\n                            padding-bottom: 10px;\n                        }\n                        .location {\n                            page-break-inside: avoid;\n                            margin-bottom: 20px;\n                            border: 1px solid #e5e5e5;\n                            padding: 15px;\n                            border-radius: 4px;\n                        }\n                        .location-name {\n                            font-weight: bold;\n                            font-size: 14pt;\n                            margin-bottom: 5px;\n                        }\n                        .location-type {\n                            display: inline-block;\n                            padding: 3px 8px;\n                            background: #e8f5e9;\n                            color: #2e7d32;\n                            border-radius: 4px;\n                            font-size: 10pt;\n                            margin-bottom: 10px;\n                        }\n                        .location-address {\n                            color: #666;\n                            margin-bottom: 5px;\n                        }\n                        .location-hours {\n                            color: #4CAF50;\n                            font-weight: 500;\n                        }\n                        .footer {\n                            margin-top: 30px;\n                            text-align: center;\n                            color: #999;\n                            font-size: 10pt;\n                        }\n                    }\n                </style>\n            </head>\n            <body>\n                <h1>Rivian Locations (${e.length})</h1>\n                <p style="color: #666;">Generated on ${(new Date).toLocaleDateString()}</p>\n                ${e.map(e=>`\n                    <div class="location">\n                        <div class="location-type">${e.type}</div>\n                        <div class="location-name">${e.name}</div>\n                        <div class="location-address">\n                            ${e.address}<br>\n                            ${e.city}\n                        </div>\n                        ${e.hours?`<div class="location-hours">${e.hours}</div>`:""}\n                        ${e.phone?`<div>Phone: ${e.phone}</div>`:""}\n                        ${e.services&&e.services.length>0?`<div style="margin-top: 5px;">Services: ${e.services.join(", ")}</div>`:""}\n                    </div>\n                `).join("")}\n                <div class="footer">\n                    Printed from RivianSpotter.com\n                </div>\n            </body>\n            </html>\n        `,exportCSV(e){try{const t=["Name","Type","Address","City","State","Phone","Hours","Services"],n=e.map(e=>[e.name,e.type,e.address,e.city,e.state,e.phone||"",e.hours||"",(e.services||[]).join("; ")]),o=[t.join(","),...n.map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(","))].join("\n"),a=new Blob([o],{type:"text/csv"}),i=URL.createObjectURL(a),r=document.createElement("a");r.href=i,r.download=`rivian-locations-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),FavoritesManager.showNotification("CSV exported successfully")}catch(e){console.error("Failed to export CSV:",e),alert("Failed to export CSV")}},exportJSON(e){try{const t={exported:(new Date).toISOString(),count:e.length,locations:e},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=`rivian-locations-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o),FavoritesManager.showNotification("JSON exported successfully")}catch(e){console.error("Failed to export JSON:",e),alert("Failed to export JSON")}}},RecentLocationsManager={init(){try{const e=localStorage.getItem("rivian_recent_locations");e&&(FeatureState.recentLocations=JSON.parse(e))}catch(e){console.error("Failed to load recent locations:",e)}},addRecent(e){try{FeatureState.recentLocations=FeatureState.recentLocations.filter(t=>t!==e),FeatureState.recentLocations.unshift(e),FeatureState.recentLocations.length>FeatureState.maxRecentLocations&&(FeatureState.recentLocations=FeatureState.recentLocations.slice(0,FeatureState.maxRecentLocations)),this.saveRecent(),this.updateUI()}catch(e){console.error("Failed to add recent location:",e)}},saveRecent(){try{localStorage.setItem("rivian_recent_locations",JSON.stringify(FeatureState.recentLocations))}catch(e){console.error("Failed to save recent locations:",e)}},clearRecent(){FeatureState.recentLocations=[],this.saveRecent(),this.updateUI(),FavoritesManager.showNotification("Recent locations cleared")},getRecent:()=>FeatureState.recentLocations.map(e=>rivianLocations.find(t=>t.id===e)).filter(e=>void 0!==e),updateUI(){const e=document.getElementById("recentLocationsList");if(!e)return;const t=this.getRecent();0!==t.length?e.innerHTML=t.map(e=>`\n            <div class="recent-location-item"\n                 onclick="LocationManager.flyToLocation(${e.lng}, ${e.lat}, ${e.id}); RecentLocationsManager.addRecent(${e.id})">\n                <div class="recent-location-type ${"Demo Center"===e.type?"demo-center":"Outpost"===e.type?"outpost":""}">${e.type}</div>\n                <div class="recent-location-name">${e.name}</div>\n                <div class="recent-location-city">${e.city}</div>\n            </div>\n        `).join(""):e.innerHTML='\n                <div style="padding: 1rem; text-align: center; color: #999; font-size: 0.9rem;">\n                    No recent locations\n                </div>\n            '}};function setupFeatureEventHandlers(){const e=document.getElementById("favoritesFilterBtn");e&&e.addEventListener("click",()=>{FavoritesManager.filterFavorites()});const t=document.getElementById("exportFavoritesBtn");t&&t.addEventListener("click",()=>{FavoritesManager.exportFavorites()});const n=document.getElementById("importFavoritesBtn"),o=document.getElementById("importFavoritesInput");n&&o&&(n.addEventListener("click",()=>{o.click()}),o.addEventListener("change",e=>{e.target.files.length>0&&FavoritesManager.importFavorites(e.target.files[0])}));const a=document.getElementById("clearRecentBtn");a&&a.addEventListener("click",()=>{confirm("Clear all recent locations?")&&RecentLocationsManager.clearRecent()});const i=document.getElementById("exportCSVBtn");i&&i.addEventListener("click",()=>{ExportManager.exportCSV(rivianLocations)});const r=document.getElementById("exportJSONBtn");r&&r.addEventListener("click",()=>{ExportManager.exportJSON(rivianLocations)});const s=document.getElementById("printAllBtn");s&&s.addEventListener("click",()=>{ExportManager.printAllLocations()})}if(document.addEventListener("DOMContentLoaded",function(){FavoritesManager.init(),SharingManager.init(),RecentLocationsManager.init(),setupFeatureEventHandlers()}),"undefined"!=typeof LocationManager){const e=LocationManager.flyToLocation;LocationManager.flyToLocation=function(t,n,o){return RecentLocationsManager.addRecent(o),e.call(this,t,n,o)}}window.FavoritesManager=FavoritesManager,window.SharingManager=SharingManager,window.ExportManager=ExportManager,window.RecentLocationsManager=RecentLocationsManager;
//# sourceMappingURL=features.min.js.map